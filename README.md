# Telegram-bot домашка

«Telegram-bot домашка» -программа оповещения об изменении статуса проверки домашней работы курса «Яндекс.Практикум» с помощью Telegram-бота.

Раз в 10 минут программа отправляет запрос к API сервиса «Практикум.Домашка» и проверяет статус отправленной на ревью домашней работы.

При обновлении статуса Telegram-бот отправляет пользователю соответствующее уведомление.

Программа полностью логирует свою работу и сообщает о важных проблемах сообщением в Telegram.

## Задача

Реализовать програмный модуль взаимодействия с API «Практикум.Домашка» для получения информации о статусе домашней работы.

Программа должна: 

* Раз в 10 минут отправлять запрос к API и приводить данные ответа в формат Python;

* Проверять данные на соответствие ожидаемой структуре;

* Извлекать из данных и отправлять личным сообщением в Telegram информацию о статуса домашней работы;

* Отправлять в Telegram сообщение об ошибках в работе API;

* Полностью логировать ход своей работы с выводом в стандартный поток `sys.stdout`.


## Реализация

Программа структурно разделена на 3 части:

    1. Объявление переменных необходимых для запуска программы и настройка логирования;

    2. Описание функций обработки запроса и отправки сообщения в Telegram;

    3. Описание функции основной логики работы программы.

---
<br>

    1. Объявление глобальных переменных запуска программы и настройка логирования

В основе работы программы лежит следующий набор параметров:

* PRACTICUM_TOKEN - токен студента «Яндекс.Практикум», необходим для отправки запроса к API;
* TELEGRAM_TOKEN - токен Telegram-бота, необходим для отправки сообщений в личный чат;
* TELEGRAM_CHAT_ID - идентификатор чата вашего Telegram аккаунта;
* RETRY_TIME - интервал оживания между запросами;
* ENDPOINT - эндпоинт запроса к API «Практикум.Домашка»;
* HEADERS - содержит токен студента «Яндекс.Практикум» и передаётся в качестве параметра запроса к API;
* HOMEWORK_STATUSES - словарь, где ключ - статус домашней работы в ответе API, а значение - сообщение, отправляемое студенту в Telegram;

Значения первых трёх параметров конфиденциальны и сообщаются программе из файла .env с помощью функции `load_dotenv()` стандартный библиотеки `dotenv`.

В качестве инструмента логирования использована стандартная библиотека Python `logging`. Логгеру задан уровень 'DEBUG', сообщения других уровней явно указаны в функции основной логики `main()`. Логгер выводит информацию в стандартный поток `sys.stdout` в формате "*время - уровень логирования - сообщение*".

---
<br>

    2. Описание функций обработки запроса и отправки сообщения в Telegram

В работе телеграм-бота задействовано 6 вспомогательных функций. С их помощью бот делает запрос к API, обрабатывает полученную информацию и отправляет личное сообщение в Telegram.

```python
def check_tokens()

Проверяет доступность переменных окружения, которые необходимы для работы программы.
```

```python
def get_api_answer()

Делает запрос к единственному эндпоинту API-сервиса.
В качестве параметра в функцию передается временная метка.
В случае успешного запроса возвращает ответ API, приведя его из формата JSON к типам данных Python.
```

```python
def check_response()

Проверяет ответ API на соответствие документации. 
В качестве параметра функция получает ответ API, приведенный к типам данных Python.
```

```python
def parse_status()

Извлекает из информации о конкретной домашней работе статус этой работы.
В качестве параметра функция получает только один элемент из списка домашних работ.
В случае успеха, функция возвращает подготовленную для отправки в Telegram строку,
содержащую один из вердиктов словаря HOMEWORK_VERDICTS.
```

```python
def send_message()

Отправляет сообщение в Telegram чат, определяемый переменной окружения TELEGRAM_CHAT_ID.
Принимает на вход два параметра: экземпляр класса Bot и строку с текстом сообщения.
```


---
<br>

    3. Описание функции основной логики работы программы

Основную логику работы программы реализована в функции `main()`.
В теле этой функции последовательно запускаются вспомогательные функции и ведётся логирование их работы.

Алгоритм работы `main()` выглядит следующим образом:

    1.    Проверка доступности токенов
    
    2.    Запуск бота
    
    3.    Вход в цикл запросов к API

              3.1 Запрос к API и проверка ответа

                  3.1.1 Подготовка и отправка сообщения в Telegram о статусе домашней работы

                    или

                  3.1.2  Отправка сообщения в Telegram о сбое в работе программы

              3.2 Таймаут работы 10 минут и возврат к пункту 3.1


## Использование программы локально
*Для запуска программы потребуется установленный Python версии 3.7 и выше.*

Создайте папку с названием модуля и инициализируйте репозиторий:
```bash
mkdir homework_bot
```
```bash
cd homework_bot
```
```bash
git init
```

Скачайте репозиторий в созданную папку:
```bash
git clone git@github.com:rock4ts/homework_bot.git
```

Создайте и активируйте виртуальное окружение:
```bash
python3 -m venv venv
```
```bash
source venv/bin/activate
```

Установите записимости из файла requirements.txt:
```bash
python3 -m pip install --upgrade pip
```
```bash
pip install -r requirements.txt 
```

Перед запуском программе необходимо сообщить параметры **PRACTICUM_TOKEN**, **TELEGRAM_TOKEN** и **TELEGRAM_CHAT_ID**.

Для этого в корневой папке проекта создайте файл .env и присвойте вышеперечисленным переменным значения согласно указаниям:

- **PRACTICUM_TOKEN** - доступен для авторизованных пользователей «Яндекс.Практикум» по ссылке: [API Практикум.Домашка](https://oauth.yandex.ru/authorize?response_type=token&client_id=1d0b9dd4d652455a9eb710d450ff456a).
- **TELEGRAM_TOKEN** - токен присваивающийся Telegram-боту при создании с помощью _BotFarther_. Если вы забыли и утратили его значение, новый токен можно сгенерировать в чате _BotFarther_ с помощью функции `/token` .
- **TELEGRAM_CHAT_ID** - идентификатор чата для отправки сообщения о статусе домашней работы. Чтобы узнать личный идентификатор, нужно перенаправить любое собственное сообщение в чат _userinfobot_.
<br>

Запустите программу:
```bash
python3 homework_bot.py
```

Готово, теперь не нужно судорожно обновлять страницу с заданием :satisfied:
Идите пить чай! :cookie: :tea: